<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ORG3403 – Concept Network</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #e5e7eb;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      overflow: hidden;
      color: #111827;
    }

    #network {
      width: 100vw;
      height: 100vh;
    }

    svg {
      background: radial-gradient(circle at top, #ffffff 0%, #e5e7eb 55%, #d1d5db 100%);
    }

    .link {
      stroke: #9ca3af;
      stroke-opacity: 0.5;
    }

    .node circle {
      stroke: #0f172a;
      stroke-width: 1.2px;
      cursor: pointer;
    }

    .node text {
      font-size: 10px;
      fill: #111827;
      pointer-events: none;
      text-shadow: 0 0 2px #f9fafb;
    }

    .tooltip {
      position: absolute;
      padding: 6px 10px;
      background: #ffffff;
      border-radius: 6px;
      border: 1px solid #0ea5e9;
      font-size: 11px;
      color: #111827;
      pointer-events: none;
      opacity: 0;
      transform: translate(12px, 12px);
      max-width: 260px;
      line-height: 1.35;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
      z-index: 10;
    }

    .tooltip strong {
      color: #0f172a;
    }

    .legend {
      font-size: 11px;
    }

    .legend rect {
      rx: 4;
      ry: 4;
    }

    .legend text {
      fill: #111827;
    }
  </style>
</head>
<body>
  <div id="network"></div>
  <div class="tooltip" id="tooltip"></div>

  <script>
    // =======================================================
    // 1. MERMAID-LIKE SOURCE: ALL ORG3403 CONCEPTS & LINKS
    // =======================================================
    const mermaidSource = `
graph LR
    %% Individual Psychology Cluster
    INT["Intelligence"]
    GFAC["g-factor"]
    COGAB["Cognitive abilities"]
    PERS["Personality"]
    BIG5["Big Five"]
    NEUR["Neuroticism"]
    EXTR["Extraversion"]
    OPEN["Openness"]
    AGREE["Agreeableness"]
    CONSC["Conscientiousness"]
    HEX["HEXACO"]
    HONES["Honesty-Humility"]
    EMOT["Emotionality"]
    PERC["Perception"]
    ATTR["Attribution"]
    INTA["Internal attribution"]
    EXTA["External attribution"]
    STEREO["Stereotypes"]
    PREJ["Prejudice"]
    ATTIT["Attitudes"]
    
    %% Motivation & Well-being
    MOT["Motivation"]
    INTMOT["Intrinsic motivation"]
    EXTMOT["Extrinsic motivation"]
    NEEDT["Need theories"]
    GOALT["Goal-setting theory"]
    EXPT["Expectancy theory"]
    SELFD["Self-determination"]
    SAT["Job satisfaction"]
    ENG["Engagement"]
    VIGOR["Vigor"]
    DEDIC["Dedication"]
    ABSORP["Absorption"]
    JOBCHAR["Job characteristics model"]
    AUTON["Autonomy"]
    SKILL["Skill variety"]
    TASKID["Task identity"]
    TASKSIG["Task significance"]
    FEEDB["Feedback"]
    
    %% Stress & Coping
    STR["Stress"]
    STRES["Stressors"]
    STRAIN["Strain"]
    BURN["Burnout"]
    EXHAUST["Exhaustion"]
    CYNICISM["Cynicism"]
    INEFF["Inefficacy"]
    RES["Resilience"]
    COP["Coping"]
    PROBCOP["Problem-focused coping"]
    EMOCOP["Emotion-focused coping"]
    DEMANDS["Job demands"]
    RESOURCES["Job resources"]
    
    %% Self-Leadership
    SELF["Self-leadership"]
    SELFOBS["Self-observation"]
    SELFGOAL["Self-goal setting"]
    SELFREWA["Self-reward"]
    SELFPUN["Self-punishment"]
    SELFTALK["Self-talk"]
    MENTAL["Mental imagery"]
    
    %% Learning & Cognition
    LEARN["Learning"]
    SINGLE["Single-loop learning"]
    DOUBLE["Double-loop learning"]
    ERFAHRUNG["Experiential learning"]
    METACOG["Metacognition"]
    DEC["Decision making"]
    DECBIAS["Decision biases"]
    ANCHOR["Anchoring bias"]
    CONFIRM["Confirmation bias"]
    SUNK["Sunk cost fallacy"]
    CREA["Creativity"]
    INNOV["Innovation"]
    PROB["Problem solving"]
    
    %% Teams & Groups
    TEAM["Teams"]
    FORM["Team formation"]
    STORM["Storming phase"]
    NORM["Norming phase"]
    PERFORM["Performing phase"]
    ROLES["Team roles"]
    COHES["Cohesion"]
    SOCID["Social identity"]
    INGROUP["In-group"]
    OUTGROUP["Out-group"]
    GROUPTH["Groupthink"]
    SOCLOAF["Social loafing"]
    VIRT["Virtual teams"]
    
    %% Communication & Networks
    COMM["Communication"]
    FORMAL["Formal communication"]
    INFORMAL["Informal communication"]
    NET["Networks"]
    CENTR["Centrality"]
    BROK["Brokerage"]
    INFO["Information flow"]
    KNOWSH["Knowledge sharing"]
    
    %% Conflict & Justice
    CONF["Conflict"]
    TASKCONF["Task conflict"]
    RELCONF["Relationship conflict"]
    PROCCONF["Process conflict"]
    JUST["Justice"]
    DISTJUST["Distributive justice"]
    PROCJUST["Procedural justice"]
    INTJUST["Interactional justice"]
    TRUST["Trust"]
    
    %% Leadership
    LEAD["Leadership"]
    TRANS["Transformational leadership"]
    CHARIS["Charisma"]
    INSPIR["Inspirational motivation"]
    INTSTIM["Intellectual stimulation"]
    INDCONS["Individual consideration"]
    TRANSAC["Transactional leadership"]
    CONTREW["Contingent reward"]
    ACTEXC["Active management by exception"]
    PASSEXC["Passive management by exception"]
    LAISS["Laissez-faire leadership"]
    AUTH["Authentic leadership"]
    SERV["Servant leadership"]
    LMXNODE["Leader-member exchange"]
    
    %% Dark Side
    DESTR["Destructive leadership"]
    NARC["Narcissism"]
    MACH["Machiavellianism"]
    PSYCH["Psychopathy"]
    ABUSUP["Abusive supervision"]
    BULLY["Bullying"]
    HARAS["Harassment"]
    
    %% Power & Influence
    POWER["Power"]
    LEGIT["Legitimate power"]
    REWARD["Reward power"]
    COER["Coercive power"]
    EXPERT["Expert power"]
    REFER["Referent power"]
    INFL["Influence tactics"]
    RATION["Rational persuasion"]
    INSPAPP["Inspirational appeals"]
    CONSULT["Consultation"]
    INGRAT["Ingratiation"]
    EXCH["Exchange"]
    COAL["Coalition building"]
    PRESS["Pressure"]
    
    %% Organizational Structure
    STRUCT["Organizational structure"]
    BUREAU["Bureaucracy"]
    MATRIX["Matrix structure"]
    NETORG["Network organization"]
    CENTRAL2["Centralization"]
    FORMAL2["Formalization"]
    SPECIAL["Specialization"]
    HIER["Hierarchy"]
    SPAN["Span of control"]
    
    %% Organizational Culture & Change
    CULT["Organizational culture"]
    VALUES["Values"]
    NORMS["Norms"]
    BELIEFS["Beliefs"]
    ARTIFACTS["Artifacts"]
    SUBCULTURES["Subcultures"]
    CHANGE["Change management"]
    RESIST["Resistance to change"]
    READINESS["Change readiness"]
    TRANSF["Transformation"]
    COMPMAN["Competence management"]
    
    %% Diversity & Context
    GEND["Gender"]
    GLASS["Glass ceiling"]
    DIV["Diversity"]
    INCL["Inclusion"]
    MULTI["Multicultural teams"]
    CROSS["Cross-cultural management"]
    HOFST["Hofstede dimensions"]
    POWDIST["Power distance"]
    INDCOLL["Individualism–collectivism"]
    UNCAVO["Uncertainty avoidance"]
    
    %% Outcomes
    PERF["Performance"]
    TASKPERF["Task performance"]
    CONTEXT["Contextual performance"]
    OCBIT["OCB - Individual"]
    OCBORG["OCB - Organization"]
    TURNOVER["Turnover intention"]
    ABSENT["Absenteeism"]
    COMMIT["Commitment"]
    AFFCOM["Affective commitment"]
    CONTCOM["Continuance commitment"]
    NORMCOM["Normative commitment"]
    
    %% Individual connections
    INT === GFAC
    INT === COGAB
    COGAB -.-> DEC
    COGAB -.-> PROB
    PERS === BIG5
    BIG5 === NEUR
    BIG5 === EXTR
    BIG5 === OPEN
    BIG5 === AGREE
    BIG5 === CONSC
    PERS === HEX
    HEX === HONES
    HEX === EMOT
    PERC === ATTR
    ATTR === INTA
    ATTR === EXTA
    PERC -.-> STEREO
    STEREO -.-> PREJ
    ATTIT -.-> PREJ
    
    %% Motivation connections
    MOT === INTMOT
    MOT === EXTMOT
    MOT === NEEDT
    MOT === GOALT
    MOT === EXPT
    MOT === SELFD
    INTMOT -.-> ENG
    EXTMOT -.-> SAT
    SAT -.-> COMMIT
    ENG === VIGOR
    ENG === DEDIC
    ENG === ABSORP
    JOBCHAR === AUTON
    JOBCHAR === SKILL
    JOBCHAR === TASKID
    JOBCHAR === TASKSIG
    JOBCHAR === FEEDB
    JOBCHAR -.-> SAT
    AUTON -.-> INTMOT
    ENG -.-> PERF
    SAT -.-> PERF
    COMMIT === AFFCOM
    COMMIT === CONTCOM
    COMMIT === NORMCOM
    COMMIT -.-> TURNOVER
    
    %% Stress connections
    STR === STRES
    STR === STRAIN
    STRAIN -.-> BURN
    BURN === EXHAUST
    BURN === CYNICISM
    BURN === INEFF
    STR -.-> COP
    COP === PROBCOP
    COP === EMOCOP
    RES -.-> COP
    DEMANDS -.-> STR
    DEMANDS -.-> BURN
    RESOURCES -.-> ENG
    RESOURCES -.-> RES
    
    %% Self-leadership connections
    SELF === SELFOBS
    SELF === SELFGOAL
    SELF === SELFREWA
    SELF === SELFPUN
    SELF === SELFTALK
    SELF === MENTAL
    SELF -.-> INTMOT
    SELF -.-> PERF
    
    %% Learning & cognition connections
    LEARN === SINGLE
    LEARN === DOUBLE
    LEARN === ERFAHRUNG
    LEARN === METACOG
    METACOG -.-> DEC
    DEC === DECBIAS
    DECBIAS === ANCHOR
    DECBIAS === CONFIRM
    DECBIAS === SUNK
    DEC -.-> PROB
    CREA === INNOV
    CREA -.-> PROB
    INNOV -.-> CHANGE
    LEARN -.-> PERF
    LEARN -.-> CHANGE
    
    %% Teams & groups connections
    TEAM === FORM
    FORM === STORM
    STORM === NORM
    NORM === PERFORM
    TEAM === ROLES
    TEAM === COHES
    COHES -.-> PERF
    SOCID === INGROUP
    SOCID === OUTGROUP
    SOCID -.-> GROUPTH
    GROUPTH -.-> DEC
    SOCLOAF -.-> PERF
    VIRT -.-> TEAM
    VIRT -.-> COMM
    
    %% Communication & networks connections
    COMM === FORMAL
    COMM === INFORMAL
    COMM -.-> INFO
    COMM -.-> KNOWSH
    NET === CENTR
    NET === BROK
    NET -.-> INFO
    CENTR -.-> POWER
    BROK -.-> POWER
    KNOWSH -.-> PERF
    KNOWSH -.-> INNOV
    
    %% Conflict & justice connections
    CONF === TASKCONF
    CONF === RELCONF
    CONF === PROCCONF
    CONF -.-> STR
    CONF -.-> BURN
    JUST === DISTJUST
    JUST === PROCJUST
    JUST === INTJUST
    JUST -.-> TRUST
    JUST -.-> SAT
    TRUST -.-> LMXNODE
    TRUST -.-> TEAM
    TRUST -.-> PERF
    
    %% Leadership connections
    LEAD === TRANS
    LEAD === TRANSAC
    LEAD === AUTH
    LEAD === SERV
    LEAD === LMXNODE
    TRANS === CHARIS
    TRANS === INSPIR
    TRANS === INTSTIM
    TRANS === INDCONS
    TRANS -.-> ENG
    TRANS -.-> PERF
    TRANSAC === CONTREW
    TRANSAC === ACTEXC
    TRANSAC === PASSEXC
    LAISS -.-> BURN
    LMXNODE -.-> SAT
    LMXNODE -.-> PERF
    AUTH -.-> TRUST
    SERV -.-> ENG
    
    %% Dark side connections
    DESTR === NARC
    DESTR === MACH
    DESTR === PSYCH
    DESTR === ABUSUP
    ABUSUP === BULLY
    ABUSUP === HARAS
    DESTR -.-> BURN
    DESTR -.-> SAT
    BULLY -.-> BURN
    BULLY -.-> TURNOVER
    HARAS -.-> STR
    
    %% Power & influence connections
    POWER === LEGIT
    POWER === REWARD
    POWER === COER
    POWER === EXPERT
    POWER === REFER
    POWER -.-> LEAD
    INFL === RATION
    INFL === INSPAPP
    INFL === CONSULT
    INFL === INGRAT
    INFL === EXCH
    INFL === COAL
    INFL === PRESS
    INFL -.-> PERF
    INFL -.-> COMMIT
    
    %% Organizational structure connections
    STRUCT === BUREAU
    STRUCT === MATRIX
    STRUCT === NETORG
    STRUCT === CENTRAL2
    STRUCT === FORMAL2
    STRUCT === SPECIAL
    STRUCT === HIER
    STRUCT === SPAN
    STRUCT -.-> CULT
    STRUCT -.-> PERF
    CENTRAL2 -.-> POWER
    FORMAL2 -.-> STR
    
    %% Culture & change connections
    CULT === VALUES
    CULT === NORMS
    CULT === BELIEFS
    CULT === ARTIFACTS
    CULT === SUBCULTURES
    CULT -.-> ATTIT
    CULT -.-> JUST
    CULT -.-> TRUST
    CHANGE === RESIST
    CHANGE === READINESS
    CHANGE === TRANSF
    CHANGE -.-> STR
    CHANGE -.-> LEARN
    TRANSF -.-> COMPMAN
    COMPMAN -.-> LEARN
    CHANGE -.-> PERF
    
    %% Diversity & context connections
    DIV === INCL
    DIV === GEND
    DIV === MULTI
    DIV === CROSS
    GEND -.-> GLASS
    MULTI -.-> TEAM
    CROSS === HOFST
    HOFST === POWDIST
    HOFST === INDCOLL
    HOFST === UNCAVO
    DIV -.-> JUST
    DIV -.-> CULT
    
    %% Outcomes connections
    PERF === TASKPERF
    PERF === CONTEXT
    PERF === OCBIT
    PERF === OCBORG
    TURNOVER -.-> PERF
    ABSENT -.-> PERF
`;

    // =======================================================
    // 2. PARSE NODES & LINKS FROM THE MERMAID TEXT
    // =======================================================
    const nodeMap = new Map();
    const linksRaw = [];
    let currentGroup = "Other";

    mermaidSource.split("\n").forEach(rawLine => {
      const line = rawLine.trim();
      if (!line || line.startsWith("graph")) return;

      // Cluster name from comments (except lines ending with 'connections')
      if (line.startsWith("%%")) {
        const txt = line.replace(/^%%\s*/, "").trim();
        if (!/connections/i.test(txt)) currentGroup = txt || "Other";
        return;
      }

      // Node definition: ID["Label"]
      const nodeMatch = line.match(/^([A-Za-z0-9_]+)\["([^"]+)"\]/);
      if (nodeMatch) {
        const id = nodeMatch[1];
        const label = nodeMatch[2];
        if (!nodeMap.has(id)) {
          nodeMap.set(id, { id, label, group: currentGroup });
        }
        return;
      }

      // Directed edges: ID --> ID , ID -.-> ID , ID ==>
      const edgeMatchDir = line.match(/^([A-Za-z0-9_]+)\s*[-.=]+>\s*([A-Za-z0-9_]+)/);
      if (edgeMatchDir) {
        linksRaw.push({ source: edgeMatchDir[1], target: edgeMatchDir[2], weight: 1 });
        return;
      }

      // Undirected edges: ID --- ID or ID === ID
      const edgeMatchUndir = line.match(/^([A-Za-z0-9_]+)\s*[-=]{3}\s*([A-Za-z0-9_]+)/);
      if (edgeMatchUndir) {
        linksRaw.push({ source: edgeMatchUndir[1], target: edgeMatchUndir[2], weight: 1 });
        return;
      }
    });

    // Ensure all edge endpoints exist as nodes
    linksRaw.forEach(l => {
      if (!nodeMap.has(l.source)) {
        nodeMap.set(l.source, { id: l.source, label: l.source, group: "Other" });
      }
      if (!nodeMap.has(l.target)) {
        nodeMap.set(l.target, { id: l.target, label: l.target, group: "Other" });
      }
    });

    const allNodes = Array.from(nodeMap.values());

    // Degree (how many links per node)
    const degree = {};
    allNodes.forEach(n => degree[n.id] = 0);
    linksRaw.forEach(l => {
      degree[l.source] = (degree[l.source] || 0) + 1;
      degree[l.target] = (degree[l.target] || 0) + 1;
    });

    // Remove completely isolated nodes (degree 0)
    const nodes = allNodes.filter(n => (degree[n.id] || 0) > 0);
    const links = linksRaw;

    // =======================================================
    // 3. D3 FORCE LAYOUT – LIGHT THEME
    // =======================================================
    const width = window.innerWidth;
    const height = window.innerHeight;

    const svg = d3.select("#network")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    const container = svg.append("g").attr("class", "container");
    const tooltip = d3.select("#tooltip");

    // Arrowheads
    const defs = svg.append("defs");
    defs.append("marker")
      .attr("id", "arrow")
      .attr("viewBox", "0 -5 10 10")
      .attr("refX", 18)
      .attr("refY", 0)
      .attr("markerWidth", 6)
      .attr("markerHeight", 6)
      .attr("orient", "auto")
      .append("path")
      .attr("d", "M0,-5L10,0L0,5")
      .attr("fill", "#9ca3af");

    // Unique cluster names
    const groups = Array.from(new Set(nodes.map(d => d.group || "Other")));

    // Palette: blues + helpers
    const palette = [
      "#003366", "#005B96", "#0EA5E9", "#38BDF8",
      "#22C55E", "#EAB308", "#F97316", "#F97373", "#A855F7"
    ];
    const color = d3.scaleOrdinal()
      .domain(groups)
      .range(palette.slice(0, groups.length));

    // Degree-based size
    const degValues = nodes.map(n => degree[n.id] || 1);
    const sizeScale = d3.scaleLinear()
      .domain([d3.min(degValues), d3.max(degValues)])
      .range([6, 24]);

    // Cluster centers placed in a ring
    const radius = Math.min(width, height) * 0.32;
    const centers = {};
    groups.forEach((g, i) => {
      const angle = (2 * Math.PI * i) / groups.length;
      centers[g] = {
        x: width / 2 + radius * Math.cos(angle),
        y: height / 2 + radius * Math.sin(angle)
      };
    });

    // Links
    const link = container.append("g")
      .attr("stroke-linecap", "round")
      .selectAll("line")
      .data(links)
      .enter()
      .append("line")
      .attr("class", "link")
      .attr("stroke-width", 1.1)
      .attr("marker-end", "url(#arrow)");

    // Nodes
    const node = container.append("g")
      .selectAll("g")
      .data(nodes)
      .enter()
      .append("g")
      .attr("class", "node")
      .call(
        d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended)
      );

    const circles = node.append("circle")
      .attr("r", d => sizeScale(degree[d.id] || 1))
      .attr("fill", d => color(d.group || "Other"));

    const labels = node.append("text")
      .attr("x", d => sizeScale(degree[d.id] || 1) + 4)
      .attr("y", 3)
      .text(d => d.label || d.id);

    // Force simulation
    const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id).distance(70).strength(0.5))
      .force("charge", d3.forceManyBody().strength(-130))
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("x", d3.forceX(d => (centers[d.group] || { x: width / 2 }).x).strength(0.18))
      .force("y", d3.forceY(d => (centers[d.group] || { y: height / 2 }).y).strength(0.18))
      .force("collision", d3.forceCollide().radius(d => sizeScale(degree[d.id] || 1) + 8));

    simulation.on("tick", () => {
      link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

      node.attr("transform", d => `translate(${d.x},${d.y})`);
    });

    // Zoom & pan
    const zoom = d3.zoom()
      .scaleExtent([0.3, 2.7])
      .on("zoom", (event) => {
        container.attr("transform", event.transform);
      });
    svg.call(zoom);

    // Hover: highlight neighbors + tooltip (English only)
    node
      .on("mouseover", (event, d) => {
        const connected = new Set();
        links.forEach(l => {
          const s = typeof l.source === "object" ? l.source.id : l.source;
          const t = typeof l.target === "object" ? l.target.id : l.target;
          if (s === d.id) connected.add(t);
          if (t === d.id) connected.add(s);
        });
        connected.add(d.id);

        circles.attr("opacity", n => connected.has(n.id) ? 1 : 0.15);
        labels.attr("opacity", n => connected.has(n.id) ? 1 : 0.15);
        link.attr("opacity", l => {
          const s = typeof l.source === "object" ? l.source.id : l.source;
          const t = typeof l.target === "object" ? l.target.id : l.target;
          return (connected.has(s) && connected.has(t)) ? 0.85 : 0.08;
        });

        const english = d.label || d.id;
        const group = d.group || "No cluster";
        const deg = degree[d.id] || 0;

        tooltip
          .style("opacity", 1)
          .html(
            `<strong>${english}</strong><br>` +
            `Cluster: ${group}<br>` +
            `Connections: ${deg}`
          )
          .style("left", (event.pageX + 12) + "px")
          .style("top", (event.pageY + 12) + "px");
      })
      .on("mousemove", (event) => {
        tooltip
          .style("left", (event.pageX + 12) + "px")
          .style("top", (event.pageY + 12) + "px");
      })
      .on("mouseout", () => {
        circles.attr("opacity", 1);
        labels.attr("opacity", 1);
        link.attr("opacity", 0.5);
        tooltip.style("opacity", 0);
      });

    // Legend for clusters (top-left)
    const legend = svg.append("g")
      .attr("class", "legend")
      .attr("transform", "translate(16,16)");

    groups.forEach((g, i) => {
      const row = legend.append("g")
        .attr("transform", `translate(0, ${i * 18})`);

      row.append("rect")
        .attr("width", 10)
        .attr("height", 10)
        .attr("fill", color(g));

      row.append("text")
        .attr("x", 16)
        .attr("y", 9)
        .text(g);
    });

    // Drag behaviour
    function dragstarted(event, d) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(event, d) {
      d.fx = event.x;
      d.fy = event.y;
    }

    function dragended(event, d) {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

    // Resize handling
    window.addEventListener("resize", () => {
      const w = window.innerWidth;
      const h = window.innerHeight;
      svg.attr("width", w).attr("height", h);
      simulation.force("center", d3.forceCenter(w / 2, h / 2));
      simulation.alpha(0.7).restart();
    });
  </script>
</body>
</html>
